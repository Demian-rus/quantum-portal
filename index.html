<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, maximum-scale=5.0, user-scalable=yes">
  <title>–ö–≤–∞–Ω—Ç–æ–≤—ã–π –ø–æ—Ä—Ç–∞–ª</title>

  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–≤–æ–¥–∞ -->
  <div id="hidden-input" style="display:none;"></div>


  <!-- ====== –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù ====== -->
  <div id="start-screen" class="start-screen">
    <div class="start-card">
      <img src="logo-qx.png" alt="–ö–≤–∞–Ω—Ç –ò–∫—Å" class="start-logo">
      <h2 class="start-title">–ö–í–ê–ù–¢–û–í–´–ô –ü–û–†–¢–ê–õ</h2>
      <p class="start-sub">–§–∏–∑–º–∞—Ç‚Äë–∏–≥—Ä—ã –∏ –∫–≤–∞–Ω—Ç–æ–≤–∞—è –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∞</p>

      <div class="start-buttons">
        <button class="primary" data-target="crossword">–ö—Ä–æ—Å—Å–≤–æ—Ä–¥</button>
        <button class="primary" data-target="philword">–§–∏–ª–≤–æ—Ä–¥</button>
        <button class="primary" data-target="sudoku">–°—É–¥–æ–∫—É</button>
        <button class="primary" data-target="quant">–ö–≤–∞–Ω—Ç</button>
        <!-- <button class="primary" data-target="future">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button> -->
      </div>

      <div class="start-footer">
        <button class="action" id="btn-open-stats">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button class="danger" id="btn-reset-stats">‚ôª –°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
      </div>
    </div>
  </div>


  <!-- ====== –ü–û–ü–ê–ü –°–¢–ê–¢–ò–°–¢–ò–ö–ò ====== -->
  <div id="stats-popup" class="stats-backdrop" style="display:none;">
    <div class="stats-modal">
      <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ä—Ç–∞–ª–∞</h3>
      <p class="stats-note">–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ.</p>

      <div class="stats-grid" id="stats-content">
        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
      </div>

      <div class="stats-actions">
        <button class="primary" id="btn-close-stats">OK</button>
      </div>
    </div>
  </div>


  <!-- ====== –ü–û–ü–ê–ü –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø ====== -->
  <div id="qp-popup" style="display:none" class="popup-backdrop">
    <div class="popup">
      <p id="qp-popup-text"></p>
      <div class="popup-actions">
        <button id="qp-popup-ok" class="primary">–î–∞</button>
        <button id="qp-popup-cancel" class="danger">–ù–µ—Ç</button>
      </div>
    </div>
  </div>


  <!-- ====== –ü–û–ü–ê–ü –ù–ê–°–¢–†–û–ï–ö ====== -->
  <div id="settings-popup" class="settings-backdrop" style="display:none;">
    <div class="settings-modal">
      <h3>‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
      <p class="settings-note">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ —Ç–µ–∫—É—â–µ–π –∞–∫—Ç–∏–≤–Ω–æ–π –∏–≥—Ä–µ.</p>

      <!-- –ë–õ–û–ö: –¢–µ–º–∞/–¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ (–∫—Ä–æ—Å—Å–≤–æ—Ä–¥, —Ñ–∏–ª–≤–æ—Ä–¥) -->
      <div class="settings-block" id="settings-block-theme">
        <h4>–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</h4>
        <div class="settings-options" id="settings-theme-opts">
          <button class="settings-toggle" data-theme="—Ñ–∏–∑–∏–∫–∞">–§–∏–∑–∏–∫–∞</button>
          <button class="settings-toggle" data-theme="–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</button>
          <button class="settings-toggle" data-theme="—Ñ–∏–∑–º–∞—Ç">–§–∏–∑–ú–∞—Ç</button>
          <!-- –∫—Ä–æ—Å—Å–≤–æ—Ä–¥: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–º—ã -->
          <button class="settings-toggle cw-only" data-theme="–∏—Å—Ç–æ—Ä–∏—è">–ò—Å—Ç–æ—Ä–∏—è</button>
          <button class="settings-toggle cw-only" data-theme="–æ–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ">–û–±—â–µ—Å—Ç–≤–æ</button>
          <button class="settings-toggle cw-only" data-theme="–≤—Å–µ">–í—Å–µ</button>
        </div>
      </div>

      <!-- –ë–õ–û–ö: –°–ª–æ–∂–Ω–æ—Å—Ç—å (–≤—Å–µ –∏–≥—Ä—ã) -->
      <div class="settings-block" id="settings-block-diff">
        <h4>–°–ª–æ–∂–Ω–æ—Å—Ç—å</h4>
        <div class="settings-options settings-difficulty" id="settings-diff-opts">
          <button class="settings-diff-btn active" data-diff="easy"   title="–õ—ë–≥–∫–∏–π">‚òÖ –õ—ë–≥–∫–∏–π</button>
          <button class="settings-diff-btn"        data-diff="medium" title="–°—Ä–µ–¥–Ω–∏–π">‚òÖ‚òÖ –°—Ä–µ–¥–Ω–∏–π</button>
          <button class="settings-diff-btn"        data-diff="hard"   title="–°–ª–æ–∂–Ω—ã–π">‚òÖ‚òÖ‚òÖ –°–ª–æ–∂–Ω—ã–π</button>
          <!-- —Å—É–¥–æ–∫—É: 4-–π —É—Ä–æ–≤–µ–Ω—å -->
          <button class="settings-diff-btn su-only" data-diff="insane" title="–ë–µ–∑—É–º–Ω—ã–π">üíÄ –ë–µ–∑—É–º–Ω—ã–π</button>
        </div>
      </div>

      <!-- –ë–õ–û–ö: –†–µ–∂–∏–º (–∫–≤–∞–Ω—Ç –∏ –∫—Ä–æ—Å—Å–≤–æ—Ä–¥) -->
      <div class="settings-block" id="settings-block-mode">
        <h4>–†–µ–∂–∏–º –∏–≥—Ä—ã</h4>

        <!-- –ö–≤–∞–Ω—Ç: –¢–µ—Ä–º–∏–Ω / –ö–≤–∞–Ω—Ç–ª -->
        <div class="settings-sub-block quant-only" id="settings-quant-mode">
          <span class="settings-label">–ö–≤–∞–Ω—Ç</span>
          <div class="settings-options">
            <button class="settings-toggle active" data-mode="term">–¢–µ—Ä–º–∏–Ω</button>
            <button class="settings-toggle" data-mode="wordle">–ö–≤–∞–Ω—Ç–ª</button>
          </div>
        </div>

        <!-- –ö—Ä–æ—Å—Å–≤–æ—Ä–¥: —Ñ–æ—Ä–º–∞ —Å–µ—Ç–∫–∏ -->
        <div class="settings-sub-block cw-only" id="settings-cw-variant">
          <span class="settings-label">–§–æ—Ä–º–∞ —Å–µ—Ç–∫–∏</span>
          <div class="settings-options">
            <button class="settings-toggle active" data-cw-variant="free">–°–≤–æ–±–æ–¥–Ω–∞—è</button>
            <button class="settings-toggle" data-cw-variant="square">–ö–≤–∞–¥—Ä–∞—Ç</button>
            <button class="settings-toggle" data-cw-variant="diamond">–†–æ–º–±</button>
            <button class="settings-toggle" data-cw-variant="cross">–ö—Ä–µ—Å—Ç</button>
          </div>
        </div>

        <!-- –§–∏–ª–≤–æ—Ä–¥: —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏ -->
        <div class="settings-sub-block ph-only" id="settings-ph-size">
          <span class="settings-label">–†–∞–∑–º–µ—Ä –ø–æ–ª—è</span>
          <div class="settings-options">
            <button class="settings-toggle" data-ph-size="12">12√ó12</button>
            <button class="settings-toggle active" data-ph-size="14">14√ó14</button>
            <button class="settings-toggle" data-ph-size="16">16√ó16</button>
          </div>
        </div>
      </div>

      <!-- –ë–õ–û–ö: –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
      <div class="settings-block" id="settings-block-general">
        <h4>–û–±—â–∏–µ</h4>
        <div class="settings-row">
          <span class="settings-label">–ó–≤—É–∫</span>
          <div class="settings-options">
            <button class="settings-toggle active" data-option="sound-on">–í–∫–ª</button>
            <button class="settings-toggle" data-option="sound-off">–í—ã–∫–ª</button>
          </div>
        </div>
        <div class="settings-row">
          <span class="settings-label">–ê–Ω–∏–º–∞—Ü–∏–∏</span>
          <div class="settings-options">
            <button class="settings-toggle active" data-option="anim-full">–ü–æ–ª–Ω—ã–µ</button>
            <button class="settings-toggle" data-option="anim-lite">–ú–∏–Ω–∏–º—É–º</button>
            <button class="settings-toggle" data-option="anim-off">–í—ã–∫–ª</button>
          </div>
        </div>
      </div>

      <div class="settings-actions">
        <button class="primary" id="btn-settings-apply" type="button">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        <button class="danger"  id="btn-settings-cancel" type="button">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>


  <!-- ====== –í–ï–†–•–ù–ï–ï –ú–ï–ù–Æ / –ù–ê–í–ò–ì–ê–¶–ò–Ø ====== -->
  <nav>
    <button id="btn-main-menu" class="tab menu-tab" type="button">–ú–µ–Ω—é</button>
    <button class="tab active" data-tab="crossword" type="button">–ö—Ä–æ—Å—Å–≤–æ—Ä–¥</button>
    <button class="tab" data-tab="philword" type="button">–§–∏–ª–≤–æ—Ä–¥</button>
    <button class="tab" data-tab="sudoku" type="button">–°—É–¥–æ–∫—É</button>
    <button class="tab" data-tab="quant" type="button">–ö–≤–∞–Ω—Ç</button>
  </nav>

  <!-- –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
  <div class="header-area">
  <div class="header-inner">
    <h1 class="header-title">‚¨° –ö–í–ê–ù–¢–û–í–´–ô –ü–û–†–¢–ê–õ</h1>
    <p class="sub" id="sub-title">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</p>
    <button id="btn-open-settings" class="settings-btn" type="button" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öô</button>
  </div>
</div>

  <!-- ====== –ö–†–û–°–°–í–û–†–î ====== -->
  <div id="sec-crossword" class="game-section active">

    <!-- –°–∫—Ä—ã—Ç—ã–µ –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—á–∏—Ç–∞—é—Ç—Å—è JS) -->
    <input type="hidden" id="sel-theme"  value="—Ñ–∏–∑–º–∞—Ç">
    <input type="hidden" id="sel-level"  value="—Å—Ä–µ–¥–Ω–∏–π">
    <input type="hidden" id="cw-variant" value="free">

    <div class="controls">
      <div class="control-group">
        <button class="primary" onclick="onGenerate()">‚ü≥ –°–æ–∑–¥–∞—Ç—å</button>
        <button class="action" onclick="onToggleAnswers()" id="btn-answ">üëÅ –û—Ç–≤–µ—Ç—ã</button>
        <button class="danger"
                onclick="usedWordsHistory.clear(); document.getElementById('stat').textContent='‚ôª –ò—Å—Ç–æ—Ä–∏—è —Å–±—Ä–æ—à–µ–Ω–∞';">
          ‚ôª –°–±—Ä–æ—Å
        </button>
      </div>
    </div>

    <!-- –°—Ç—Ä–æ–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div class="game-status-bar" id="cw-status">
    –¢–µ–º–∞: <span id="cw-status-theme">–§–∏–∑–ú–∞—Ç</span> &nbsp;¬∑&nbsp;
    –°–ª–æ–∂–Ω–æ—Å—Ç—å: <span id="cw-status-level">–°—Ä–µ–¥–Ω–∏–π</span>
    </div>

    <div class="stat-line" id="stat">–ì–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</div>

    <div class="main-container">
      <div class="game-area cw-area">
        <div id="active-q-panel">–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫—Ä–æ—Å—Å–≤–æ—Ä–¥ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–µ—Ç–∫—É</div>
        <canvas id="cv"></canvas>
      </div>

      <div id="sidebar" class="collapsed"
           onclick="if(this.classList.contains('collapsed')) toggleSidebar()">
        <div class="sb-header">
          <h2 class="sb-title">–°–ü–ò–°–û–ö –í–û–ü–†–û–°–û–í</h2>
          <button class="toggle-btn" onclick="toggleSidebar(event)">‚ùØ</button>
        </div>
        <div class="sb-content" id="cluesList"></div>
      </div>
    </div>
  </div>


  <!-- ====== –§–ò–õ–í–û–†–î ====== -->
  <div id="sec-philword" class="game-section">

    <input type="hidden" id="sel-theme-ph"  value="—Ñ–∏–∑–º–∞—Ç">
    <input type="hidden" id="sel-level-ph"  value="—Å—Ä–µ–¥–Ω–∏–π">
    <input type="hidden" id="sel-size-ph"   value="14">

    <div class="controls">
      <div class="control-group">
        <button class="primary" onclick="philGenerate()">‚ü≥ –°–æ–∑–¥–∞—Ç—å</button>
        <button class="action" onclick="philToggleAnswers()" id="btn-ph-answ">üëÅ –û—Ç–≤–µ—Ç—ã</button>
        <button class="danger"
                onclick="philUsedWordsHistory.clear(); document.getElementById('phil-stat').textContent='‚ôª –ò—Å—Ç–æ—Ä–∏—è —Ñ–∏–ª–≤–æ—Ä–¥–∞ —Å–±—Ä–æ—à–µ–Ω–∞';">
          ‚ôª –°–±—Ä–æ—Å
        </button>
      </div>
    </div>

    <div class="game-status-bar" id="ph-status">
    –¢–µ–º–∞: <span id="ph-status-theme">–§–∏–∑–ú–∞—Ç</span> &nbsp;¬∑&nbsp;
    –°–ª–æ–∂–Ω–æ—Å—Ç—å: <span id="ph-status-level">–°—Ä–µ–¥–Ω–∏–π</span>
    </div>

    <div class="stat-line" id="phil-stat">–ì–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∏–ª–≤–æ—Ä–¥–∞</div>

    <div class="main-container">
      <div class="game-area">
        <div id="phil-active-panel">–ù–∞–∂–º–∏—Ç–µ ¬´–°–æ–∑–¥–∞—Ç—å¬ª, –∑–∞—Ç–µ–º –≤—ã–¥–µ–ª—è–π—Ç–µ —Å–ª–æ–≤–∞ –ø—Ä–æ—Ç—è–∂–∫–æ–π –ø–æ –±—É–∫–≤–∞–º</div>
        <canvas id="cvPhil"></canvas>
      </div>

      <div id="philSidebar">
        <div class="sb-header" onclick="toggleSidebar(event)">
          <h2 class="sb-title" style="opacity:1">–°–õ–û–í–ê –î–õ–Ø –ü–û–ò–°–ö–ê</h2>
          <button class="toggle-btn">‚ùØ</button>
        </div>
        <div class="sb-content" id="philWords"></div>
      </div>
    </div>
  </div>


  <!-- ====== –°–£–î–û–ö–£ ====== -->
  <div id="sec-sudoku" class="game-section">

    <input type="hidden" id="sel-diff-su" value="medium">

    <div class="controls">
      <div class="control-group">
        <button class="primary" onclick="sudokuGenerate()">‚ü≥ –°–æ–∑–¥–∞—Ç—å</button>
        <button class="action" onclick="sudokuCheck()" id="btn-su-check">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        <button class="danger" onclick="sudokuReset()">‚ôª –°–±—Ä–æ—Å</button>
      </div>
    </div>

    <div class="game-status-bar" id="su-status">
      –°–ª–æ–∂–Ω–æ—Å—Ç—å: <span id="su-status-level">–°—Ä–µ–¥–Ω–∏–π</span>
    </div>

    <div class="stat-line" id="su-stat">–ì–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—É–¥–æ–∫—É</div>

    <div class="main-container">
      <div class="game-area">
        <div id="su-active-panel">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–µ—Ç–∫—É –∏ –≤–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—É (1-9)</div>
        <canvas id="cvSudoku"></canvas>

        <div class="su-numpad">
          <button onclick="sudokuInput(1)">1</button>
          <button onclick="sudokuInput(2)">2</button>
          <button onclick="sudokuInput(3)">3</button>
          <button onclick="sudokuInput(4)">4</button>
          <button onclick="sudokuInput(5)">5</button>
          <button onclick="sudokuInput(6)">6</button>
          <button onclick="sudokuInput(7)">7</button>
          <button onclick="sudokuInput(8)">8</button>
          <button onclick="sudokuInput(9)">9</button>
          <button onclick="sudokuInput(0)" class="clr">‚å´</button>
        </div>
      </div>
    </div>
  </div>


  <!-- ====== –ö–í–ê–ù–¢ ====== -->
  <div id="sec-quant" class="game-section">

    <input type="hidden" id="qnt-mode-value"  value="term">
    <input type="hidden" id="qnt-diff-value"  value="easy">

    <div class="controls">
      <div class="control-group">
        <button class="primary" onclick="quantNewRound()" type="button">‚ü≥ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
      </div>
    </div>

    <div class="game-status-bar" id="qnt-status">
      –†–µ–∂–∏–º: <span id="qnt-status-mode">–¢–µ—Ä–º–∏–Ω</span> &nbsp;¬∑&nbsp;
      –°–ª–æ–∂–Ω–æ—Å—Ç—å: <span id="qnt-status-diff">‚òÖ –õ—ë–≥–∫–∏–π</span>
    </div>

    <div class="stat-line" id="qnt-stat">–ì–æ—Ç–æ–≤ –∫ –∏–≥—Ä–µ –ö–≤–∞–Ω—Ç</div>

    <div class="main-container" style="flex-direction: column; align-items: center;">
      <div class="game-area qnt-area">
        <div id="qnt-term-hint" class="qnt-hint"></div>

        <div id="qnt-active-panel">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –≤ ‚öô –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É</div>

        <div class="qnt-grid-wrap">
          <div class="qnt-grid qnt-grid-term" id="qnt-term-grid"></div>
          <div class="qnt-grid qnt-grid-wordle" id="qnt-wordle-grid" hidden></div>
        </div>

        <div class="qnt-keyboard-desktop" id="qntKeyboardDesktop"></div>

        <div class="qnt-stats">
          <div class="qnt-stat-item">
            <div class="qnt-stat-value" id="qnt-attempts">5</div>
            <div>–ü–æ–ø—ã—Ç–æ–∫</div>
          </div>
          <div class="qnt-stat-item">
            <div class="qnt-stat-value" id="qnt-wins">0</div>
            <div>–ü–æ–±–µ–¥</div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- ====== –û–ë–©–ê–Ø –ö–ò–†–ò–õ–õ–ò–ß–ï–°–ö–ê–Ø –ö–õ–ê–í–ò–ê–¢–£–†–ê ====== -->
  <div id="mobile-keyboard">
    <div class="kb-row">
      <button data-key="–ô">–ô</button>
      <button data-key="–¶">–¶</button>
      <button data-key="–£">–£</button>
      <button data-key="–ö">–ö</button>
      <button data-key="–ï">–ï</button>
      <button data-key="–ù">–ù</button>
      <button data-key="–ì">–ì</button>
      <button data-key="–®">–®</button>
      <button data-key="–©">–©</button>
      <button data-key="–ó">–ó</button>
      <button data-key="–•">–•</button>
      <button data-key="–™">–™</button>
    </div>
    <div class="kb-row">
      <button data-key="–§">–§</button>
      <button data-key="–´">–´</button>
      <button data-key="–í">–í</button>
      <button data-key="–ê">–ê</button>
      <button data-key="–ü">–ü</button>
      <button data-key="–†">–†</button>
      <button data-key="–û">–û</button>
      <button data-key="–õ">–õ</button>
      <button data-key="–î">–î</button>
      <button data-key="–ñ">–ñ</button>
      <button data-key="–≠">–≠</button>
    </div>
    <div class="kb-row">
      <button data-key="–Ø">–Ø</button>
      <button data-key="–ß">–ß</button>
      <button data-key="–°">–°</button>
      <button data-key="–ú">–ú</button>
      <button data-key="–ò">–ò</button>
      <button data-key="–¢">–¢</button>
      <button data-key="–¨">–¨</button>
      <button data-key="–ë">–ë</button>
      <button data-key="–Æ">–Æ</button>
      <button data-key="–Å">–Å</button>
      <button data-key="Backspace" class="kb-del">‚å´</button>
    </div>
  </div>


  <!-- ====== –°–ö–†–ò–ü–¢–´ ====== -->
  <script src="db.js"></script>
  <script src="core.js"></script>
  <script src="crossword.js"></script>
  <script src="philword.js"></script>
  <script src="sudoku.js"></script>
  <script src="quant.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {

      // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ç–∞–±–∞–º
      document.querySelectorAll('nav .tab[data-tab]').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-tab');
          if (typeof switchTab === 'function') switchTab(id);
        });
      });

      // ‚îÄ‚îÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –æ—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const settingsPopup  = document.getElementById('settings-popup');
      const btnOpenSettings = document.getElementById('btn-open-settings');
      const btnApply       = document.getElementById('btn-settings-apply');
      const btnCancel      = document.getElementById('btn-settings-cancel');

      btnOpenSettings.addEventListener('click', openSettings);
      btnCancel.addEventListener('click', () => settingsPopup.style.display = 'none');
      settingsPopup.addEventListener('click', e => {
        if (e.target === settingsPopup) settingsPopup.style.display = 'none';
      });

      // –¢–æ–≥–ª—ã –≤–Ω—É—Ç—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫: –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –≤ –≥—Ä—É–ø–ø–µ
      settingsPopup.querySelectorAll('.settings-options').forEach(group => {
        group.querySelectorAll('.settings-toggle, .settings-diff-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            group.querySelectorAll('.settings-toggle, .settings-diff-btn')
                 .forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
          });
        });
      });

      // ‚îÄ‚îÄ –ü—Ä–∏–º–µ–Ω–∏—Ç—å ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      btnApply.addEventListener('click', applySettings);

      function getActiveGame() {
        const sec = document.querySelector('.game-section.active');
        return sec ? sec.id.replace('sec-', '') : null;
      }

      function openSettings() {
        const game = getActiveGame();

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/–ø—Ä—è—á–µ–º –±–ª–æ–∫–∏ –ø–æ –∏–≥—Ä–µ
        document.querySelectorAll('.cw-only').forEach(el =>
          el.style.display = game === 'crossword' ? '' : 'none');
        document.querySelectorAll('.ph-only').forEach(el =>
          el.style.display = game === 'philword' ? '' : 'none');
        document.querySelectorAll('.su-only').forEach(el =>
          el.style.display = game === 'sudoku' ? '' : 'none');
        document.querySelectorAll('.quant-only').forEach(el =>
          el.style.display = game === 'quant' ? '' : 'none');

        // –¢–µ–º–∞: —Å—É–¥–æ–∫—É –∏ –ö–≤–∞–Ω—Ç ‚Äî —Å–∫—Ä—ã—Ç—å –±–ª–æ–∫ —Ç–µ–º—ã
        document.getElementById('settings-block-theme').style.display =
          (game === 'sudoku' || game === 'quant') ? 'none' : '';

        // –†–µ–∂–∏–º: —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–æ—Å—Å–≤–æ—Ä–¥–∞ –∏ –ö–≤–∞–Ω—Ç–∞
        document.getElementById('settings-block-mode').style.display =
          (game === 'crossword' || game === 'quant' || game === 'philword') ? '' : 'none';

        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ hidden-–ø–æ–ª–µ–π
        syncSettingsUI(game);

        settingsPopup.style.display = 'flex';
      }

      function syncSettingsUI(game) {
        // –°–ª–æ–∂–Ω–æ—Å—Ç—å
        const diffMap = {
          crossword: 'sel-level',
          philword:  'sel-level-ph',
          sudoku:    'sel-diff-su',
          quant:     'qnt-diff-value'
        };
        const diffVal = document.getElementById(diffMap[game])?.value;
        if (diffVal) {
          document.querySelectorAll('#settings-diff-opts .settings-diff-btn').forEach(b => {
            b.classList.toggle('active', b.dataset.diff === diffVal);
          });
        }

        // –¢–µ–º–∞
        const themeMap = { crossword: 'sel-theme', philword: 'sel-theme-ph' };
        if (themeMap[game]) {
          const themeVal = document.getElementById(themeMap[game])?.value;
          document.querySelectorAll('#settings-theme-opts .settings-toggle').forEach(b => {
            b.classList.toggle('active', b.dataset.theme === themeVal);
          });
        }

        // –ö–≤–∞–Ω—Ç: —Ä–µ–∂–∏–º
        if (game === 'quant') {
          const modeVal = document.getElementById('qnt-mode-value')?.value;
          document.querySelectorAll('#settings-quant-mode .settings-toggle').forEach(b => {
            b.classList.toggle('active', b.dataset.mode === modeVal);
          });
        }

        // –ö—Ä–æ—Å—Å–≤–æ—Ä–¥: –≤–∞—Ä–∏–∞–Ω—Ç —Å–µ—Ç–∫–∏
        if (game === 'crossword') {
          const varVal = document.getElementById('cw-variant')?.value;
          document.querySelectorAll('#settings-cw-variant .settings-toggle').forEach(b => {
            b.classList.toggle('active', b.dataset.cwVariant === varVal);
          });
        }

        // –§–∏–ª–≤–æ—Ä–¥: —Ä–∞–∑–º–µ—Ä
        if (game === 'philword') {
          const sizeVal = document.getElementById('sel-size-ph')?.value;
          document.querySelectorAll('#settings-ph-size .settings-toggle').forEach(b => {
            b.classList.toggle('active', b.dataset.phSize === sizeVal);
          });
        }
      }

      function applySettings() {
        const game = getActiveGame();

        // –ß–∏—Ç–∞–µ–º –≤—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        const diffBtn = document.querySelector('#settings-diff-opts .settings-diff-btn.active');
        if (diffBtn) {
          const v = diffBtn.dataset.diff;
          const diffMap = {
            crossword: 'sel-level',
            philword:  'sel-level-ph',
            sudoku:    'sel-diff-su',
            quant:     'qnt-diff-value'
          };
          const el = document.getElementById(diffMap[game]);
          if (el) el.value = v;

          // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å-—Å—Ç—Ä–æ–∫—É
          const labels = {
            easy:   '‚òÖ –õ—ë–≥–∫–∏–π',
            medium: '‚òÖ‚òÖ –°—Ä–µ–¥–Ω–∏–π',
            hard:   '‚òÖ‚òÖ‚òÖ –°–ª–æ–∂–Ω—ã–π',
            insane: 'üíÄ –ë–µ–∑—É–º–Ω—ã–π'
          };
          if (game === 'quant')     document.getElementById('qnt-status-diff').textContent = labels[v] || v;
          if (game === 'crossword') document.getElementById('cw-status-level').textContent  = labels[v] || v;
          if (game === 'philword')  document.getElementById('ph-status-level').textContent  = labels[v] || v;
          if (game === 'sudoku')    document.getElementById('su-status-level').textContent  = labels[v] || v;
        }

        // –¢–µ–º–∞
        const themeBtn = document.querySelector('#settings-theme-opts .settings-toggle.active');
        if (themeBtn) {
          const v = themeBtn.dataset.theme;
          const themeMap = { crossword: 'sel-theme', philword: 'sel-theme-ph' };
          const el = document.getElementById(themeMap[game]);
          if (el) el.value = v;
          if (game === 'crossword') document.getElementById('cw-status-theme').textContent = v;
          if (game === 'philword')  document.getElementById('ph-status-theme').textContent = v;
        }

        // –ö–≤–∞–Ω—Ç: —Ä–µ–∂–∏–º ‚Üí –≤—ã–∑–≤–∞—Ç—å setQuantMode –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
        if (game === 'quant') {
          const modeBtn = document.querySelector('#settings-quant-mode .settings-toggle.active');
          if (modeBtn) {
            const v = modeBtn.dataset.mode;
            document.getElementById('qnt-mode-value').value = v;
            const modeLabels = { term: '–¢–µ—Ä–º–∏–Ω', wordle: '–ö–≤–∞–Ω—Ç–ª' };
            document.getElementById('qnt-status-mode').textContent = modeLabels[v] || v;
            if (typeof setQuantMode === 'function') setQuantMode(v);
          }
          // –°–ª–æ–∂–Ω–æ—Å—Ç—å –ö–≤–∞–Ω—Ç–∞ ‚Üí setQuantDifficulty
          if (diffBtn && typeof setQuantDifficulty === 'function') {
            setQuantDifficulty(diffBtn.dataset.diff);
          }
        }

        // –§–∏–ª–≤–æ—Ä–¥: —Ä–∞–∑–º–µ—Ä (—Ç–æ–ª—å–∫–æ hidden, –±–µ–∑ —Å—Ç–∞—Ç—É—Å–∞)
        if (game === 'philword') {
          const sizeBtn = document.querySelector('#settings-ph-size .settings-toggle.active');
          if (sizeBtn) {
            const v = sizeBtn.dataset.phSize;
            document.getElementById('sel-size-ph').value = v;
          }
        }

        // –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
        if (game === 'crossword' && typeof onGenerate === 'function') {
          onGenerate();
        }
        if (game === 'philword' && typeof philGenerate === 'function') {
          philGenerate();
        }
        if (game === 'sudoku' && typeof sudokuGenerate === 'function') {
          sudokuGenerate();
        }
        if (game === 'quant' && typeof quantNewRound === 'function') {
          quantNewRound();
        }

        settingsPopup.style.display = 'none';
      }
    });
  </script>
</body>
</html>
